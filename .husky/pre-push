#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Use local `gh` if available
GH_CLI="./node_modules/.bin/gh"

# Fallback to global `gh` if local is not available
if [ -x "$GH_CLI" ]; then
    GH_COMMAND="$GH_CLI"
elif command -v gh &> /dev/null; then
    GH_COMMAND="gh"
else
    echo "GitHub CLI (gh) is not installed. Please run 'yarn install' or install it globally."
    exit 1
fi

# Get the current branch name
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)

# Automatically create a PR using the determined `gh` command
PR_URL=$("$GH_COMMAND" pr create --base main --head "$CURRENT_BRANCH" --title "PR for $CURRENT_BRANCH" --body "Auto-created PR" 2>/dev/null)

if [ $? -eq 0 ]; then
    echo "Pull Request created: $PR_URL"
else
    echo "Failed to create a Pull Request. Ensure GitHub CLI is authenticated and the repository has a valid 'main' branch."
    exit 1
fi
